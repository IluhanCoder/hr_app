# 📊 Демонстраційний приклад роботи системи звітів з агрегацією

## Приклад 1: Статистика співробітників по департаментах

### Що показує звіт:
- **Кількість** співробітників у кожному департаменті (COUNT)
- **Середня зарплата** по департаменту (AVG)
- **Мінімальна зарплата** (MIN)
- **Максимальна зарплата** (MAX)
- **Сума всіх зарплат** по департаменту (SUM)

### Як створити в UI:

1. **Перейдіть на сторінку звітів**: http://localhost:3000/reports

2. **Налаштуйте параметри**:
   - **Джерело даних**: `Користувачі (Users)`
   - **Виберіть поля**:
     - ✅ `jobInfo.department` - Департамент
   
3. **Додайте агрегації** (кнопка "+ Додати агрегацію"):
   
   **Агрегація 1 - Кількість співробітників:**
   - Функція: `COUNT`
   - Поле: `_id`
   - Назва: `Кількість співробітників`
   
   **Агрегація 2 - Середня зарплата:**
   - Функція: `AVG`
   - Поле: `jobInfo.salary`
   - Назва: `Середня зарплата`
   
   **Агрегація 3 - Мінімальна зарплата:**
   - Функція: `MIN`
   - Поле: `jobInfo.salary`
   - Назва: `Мінімальна зарплата`
   
   **Агрегація 4 - Максимальна зарплата:**
   - Функція: `MAX`
   - Поле: `jobInfo.salary`
   - Назва: `Максимальна зарплата`
   
   **Агрегація 5 - Загальний фонд зарплат:**
   - Функція: `SUM`
   - Поле: `jobInfo.salary`
   - Назва: `Загальний бюджет`

4. **Натисніть "Згенерувати звіт"**

### Очікуваний результат:

```
╔════════════════╦══════════════╦═══════════════╦═══════════════╦═══════════════╦═══════════════╗
║ Департамент    ║ Кількість    ║ Середня ЗП    ║ Мінімальна ЗП ║ Максимальна ЗП║ Загальний     ║
║                ║ співробітників║               ║               ║               ║ бюджет        ║
╠════════════════╬══════════════╬═══════════════╬═══════════════╬═══════════════╬═══════════════╣
║ IT             ║ 5            ║ 45,000        ║ 30,000        ║ 60,000        ║ 225,000       ║
║ HR             ║ 3            ║ 35,000        ║ 28,000        ║ 42,000        ║ 105,000       ║
║ Sales          ║ 4            ║ 38,000        ║ 32,000        ║ 50,000        ║ 152,000       ║
║ Finance        ║ 2            ║ 52,000        ║ 48,000        ║ 56,000        ║ 104,000       ║
╚════════════════╩══════════════╩═══════════════╩═══════════════╩═══════════════╩═══════════════╝
```

---

## Приклад 2: Звіт по цілям з прогресом

### Що показує:
- Кількість цілей по типах
- Середній прогрес виконання
- Мінімальний та максимальний прогрес

### Налаштування:

**Джерело**: `Цілі (Goals)`

**Поля**:
- ✅ `type` - Тип цілі

**Агрегації**:
1. COUNT на `_id` → "Кількість цілей"
2. AVG на `progressPercentage` → "Середній прогрес (%)"
3. MIN на `progressPercentage` → "Мінімальний прогрес"
4. MAX на `progressPercentage` → "Максимальний прогрес"

**Фільтр** (опціонально):
- Поле: `status`
- Оператор: `equals`
- Значення: `active`

---

## Приклад 3: Аналіз кандидатів по етапах

### Що показує:
- Кількість кандидатів на кожному етапі воронки

**Джерело**: `Кандидати (Candidates)`

**Поля**:
- ✅ `currentStage` - Поточний етап

**Агрегації**:
1. COUNT на `_id` → "Кількість кандидатів"

**Сортування**:
- Поле: `currentStage`
- Порядок: `ASC`

---

## Приклад 4: Статистика по відгукам (Reviews)

### Що показує:
- Середній бал по типах оцінювання

**Джерело**: `Відгуки (Reviews)`

**Поля**:
- ✅ `type` - Тип оцінювання
- ✅ `status` - Статус

**Агрегації**:
1. COUNT на `_id` → "Кількість відгуків"
2. AVG на `overallScore` → "Середній бал"
3. MIN на `overallScore` → "Найнижчий бал"
4. MAX на `overallScore` → "Найвищий бал"

**Фільтр**:
- Поле: `status`
- Оператор: `equals`
- Значення: `completed`

---

## 🎯 Швидкий тест через curl

### Тест 1: Статистика по департаментах

```bash
curl -X POST http://localhost:5001/api/reports/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "entityType": "users",
    "fields": ["jobInfo.department"],
    "aggregations": [
      {
        "function": "count",
        "field": "_id",
        "alias": "Кількість співробітників"
      },
      {
        "function": "avg",
        "field": "jobInfo.salary",
        "alias": "Середня зарплата"
      },
      {
        "function": "min",
        "field": "jobInfo.salary",
        "alias": "Мінімальна зарплата"
      },
      {
        "function": "max",
        "field": "jobInfo.salary",
        "alias": "Максимальна зарплата"
      },
      {
        "function": "sum",
        "field": "jobInfo.salary",
        "alias": "Загальний бюджет"
      }
    ]
  }'
```

### Тест 2: Прості фільтри

```bash
curl -X POST http://localhost:5001/api/reports/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "entityType": "users",
    "fields": ["personalInfo.firstName", "personalInfo.lastName", "jobInfo.salary"],
    "filters": [
      {
        "field": "jobInfo.department",
        "operator": "equals",
        "value": "IT"
      },
      {
        "field": "jobInfo.salary",
        "operator": "gte",
        "value": 40000
      }
    ],
    "sort": {
      "field": "jobInfo.salary",
      "order": "desc"
    }
  }'
```

---

## 📥 Експорт даних

Після генерації звіту:

1. **Експорт у CSV**: Натисніть "Експортувати в CSV"
   - Отримаєте файл з правильним форматуванням
   - Підтримка українських символів (UTF-8 BOM)
   - Коми та лапки екрануються

2. **Експорт у JSON**: Натисніть "Експортувати в JSON"
   - Включає метадані (entityType, filters, aggregations)
   - Загальну кількість рядків
   - Час генерації

---

## 💾 Збереження звіту

Щоб не налаштовувати щоразу:

1. Після генерації натисніть "Зберегти звіт"
2. Вкажіть назву (наприклад, "Статистика по департаментах")
3. Додайте опис (опціонально)
4. Звіт з'явиться в списку "Збережені звіти"
5. Запускайте одним кліком!

---

## 🔍 Доступні оператори фільтрації

- `equals` - Дорівнює
- `not_equals` - Не дорівнює
- `contains` - Містить (для рядків)
- `gt` - Більше
- `gte` - Більше або дорівнює
- `lt` - Менше
- `lte` - Менше або дорівнює
- `in` - Входить у список (наприклад: ["IT", "HR"])

---

## 🎨 Візуальні приклади використання

### Приклад конфігурації в UI:

```
┌─────────────────────────────────────────────────────┐
│ 🔍 Конструктор звіту                                │
├─────────────────────────────────────────────────────┤
│                                                      │
│ Джерело даних: [Користувачі ▼]                     │
│                                                      │
│ Поля для відображення:                              │
│ ☑ jobInfo.department                                │
│ ☐ personalInfo.firstName                            │
│ ☐ personalInfo.lastName                             │
│ ☐ jobInfo.salary                                    │
│                                                      │
│ ──────────────────────────────────────────────      │
│                                                      │
│ 📊 Агрегації:                                       │
│                                                      │
│ 1. COUNT(_id) → "Кількість"            [Видалити]  │
│ 2. AVG(jobInfo.salary) → "Середня ЗП"  [Видалити]  │
│ 3. SUM(jobInfo.salary) → "Загальна ЗП" [Видалити]  │
│                                                      │
│ [+ Додати агрегацію]                                │
│                                                      │
│ ──────────────────────────────────────────────      │
│                                                      │
│ [🚀 Згенерувати звіт] [💾 Зберегти]                │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

## ✅ Перевірте роботу прямо зараз!

1. Відкрийте: **http://localhost:3000/reports**
2. Оберіть "Користувачі" як джерело
3. Виберіть поле `jobInfo.department`
4. Додайте агрегацію COUNT на `_id`
5. Натисніть "Згенерувати звіт"
6. Побачите статистику! 🎉

---

## 🚀 Додаткові можливості

- ✅ Підтримка вкладених полів (`personalInfo.firstName`)
- ✅ Множинна фільтрація (AND логіка)
- ✅ Сортування по будь-якому полю
- ✅ Збереження конфігурацій
- ✅ Публічні/приватні звіти
- ✅ Лічильник запусків
- ✅ Історія останнього запуску

**Система готова до використання! Спробуйте прямо зараз! 🚀**
